<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tabela de Classificação</title>

  <link rel="preconnect" href="https://cdnjs.cloudflare.com">

  <style>
    :root {
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#0ea5a4;
      --muted:#94a3b8;
      --danger:#ef4444;
    }
    *{
      box-sizing:border-box;
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
    }
    body{
      margin:0;
      background:linear-gradient(180deg,#071024,#081226);
      color:#e6f0fa;
      padding:14px;
    }
    .wrap{
      max-width:1100px;
      margin:12px auto;
      background:rgba(255,255,255,0.03);
      border-radius:12px;
      padding:14px;
    }

    h1{ margin:0 0 12px; font-size:20px }

    .topbar{
      display:flex;
      gap:8px;
      align-items:center;
      margin-bottom:12px;
      flex-wrap:wrap;
    }

    button{
      background:var(--accent);
      border:none;
      color:#042;
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      transition:opacity .2s;
      font-size:14px;
    }
    button:hover{ opacity:.85 }

    button.secondary{
      background:transparent;
      color:var(--accent);
      border:1px solid rgba(255,255,255,0.1);
    }
    button.danger{
      background:var(--danger);
      color:#fff;
    }

    .controls{
      display:flex;
      gap:8px;
      margin-left:auto;
      flex-wrap:wrap;
    }

    /* MOBILE SCROLL TABELA */
    .table-container {
      overflow-x:auto;
      width:100%;
      padding-bottom:6px;
    }

    table{
      width:100%;
      min-width:900px;
      border-collapse:collapse;
      margin-top:10px;
    }
    th,td{
      padding:8px 10px;
      text-align:center;
      border-bottom:1px solid rgba(255,255,255,0.05);
    }

    tr.selected{
      background:rgba(14,165,164,0.08);
    }
    td.editable{
      cursor:pointer;
    }

    .muted{ color:var(--muted); font-size:13px }

    /* CORES DE POSIÇÃO */
    .top1{
      background:rgba(34,197,94,0.25) !important;
    }
    .bottom2{
      background:rgba(239,68,68,0.25) !important;
    }

    /* MOBILE AJUSTES */
    @media (max-width:720px){
      h1 { font-size:18px; }
      .wrap{ padding:10px }
      button{ font-size:13px; padding:7px 9px; }
      .muted{ font-size:12px }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>Campeonato Interno</h1>

    <div class="topbar">
      <div class="muted">
       
      </div>

      <div class="controls">
        <button id="addBtn">Inserir linha</button>
        <button id="delBtn" class="secondary">Excluir linha</button>
        <button id="resetPointsBtn" class="secondary">Resetar Dados da tabela</button>
        <button id="exportPdfBtn">Exportar PDF</button>
        <button id="clearBtn" class="danger secondary">Limpar tudo</button>
      </div>
    </div>

    <div class="table-container">
      <table id="table">
        <thead>
          <tr>
            <th>Posição</th>
            <th>Nome</th>
            <th>Pontos</th>
            <th>Jogos</th>
            <th>Vitórias</th>
            <th>Empates</th>
            <th>Derrotas</th>
            <th>Gols Marcados</th>
            <th>Gols Sofridos</th>
            <th>Saldo</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <footer style="margin-top:10px;">
      <code>Classificacao de Atletas</code>
    </footer>
  </div>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const STORAGE_KEY = "classificacao_times";
    const byId = id => document.getElementById(id);
    const tbody = document.querySelector("#table tbody");

    const loadData = () => {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
      catch { return []; }
    };
    const saveData = data =>
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));

    const randomId = () => Math.floor(100000 + Math.random() * 900000);

    // COMPUTE
    function computeAndSort(data) {
      data.forEach(t => {
        t.jogos = (t.vitorias|0)+(t.empates|0)+(t.derrotas|0);
        t.pontos = (t.vitorias|0)*3 + (t.empates|0);
        t.saldo = (t.golsM|0)-(t.golsS|0);
      });

      data.sort((a,b)=>
        b.pontos - a.pontos ||
        b.vitorias - a.vitorias ||
        b.empates - a.empates ||
        a.derrotas - b.derrotas ||
        b.saldo - a.saldo ||
        (b.golsM|0)-(a.golsM|0)
      );
      return data;
    }

    let state = {
      data: loadData(),
      selectedId: null
    };

    function render() {
      state.data = computeAndSort(state.data);
      saveData(state.data);
      tbody.innerHTML = "";

      state.data.forEach((t, idx) => {
        const tr = document.createElement("tr");
        tr.dataset.id = t.id;

        if (t.id == state.selectedId) tr.classList.add("selected");
        if (idx === 0) tr.classList.add("top1");
        if (idx >= state.data.length - 2) tr.classList.add("bottom2");

        tr.innerHTML = `
          <td>${idx+1}</td>
          <td class="editable" data-field="nome">${escapeHtml(t.nome)}</td>
          <td>${t.pontos}</td>
          <td>${t.jogos}</td>
          <td class="editable" data-field="vitorias">${t.vitorias}</td>
          <td class="editable" data-field="empates">${t.empates}</td>
          <td class="editable" data-field="derrotas">${t.derrotas}</td>
          <td class="editable" data-field="golsM">${t.golsM}</td>
          <td class="editable" data-field="golsS">${t.golsS}</td>
          <td>${t.saldo}</td>
        `;

        tr.addEventListener("click", () => {
          if (tr.classList.contains("editing")) return;
          state.selectedId = t.id;
          render();
        });

        tr.querySelectorAll("td.editable").forEach(td=>{
          td.addEventListener("click", e=>{
            e.stopPropagation();
            makeEditable(td, t.id);
          });
        });

        tbody.appendChild(tr);
      });
    }

    function makeEditable(td, id){
      const field = td.dataset.field;
      const original = td.textContent.trim();

      td.classList.add("editing");
      const input = document.createElement("input");
      input.type = field==="nome" ? "text" : "number";
      input.value = original;
      input.style.width = "100%";

      td.innerHTML = "";
      td.appendChild(input);
      input.focus(); input.select();

      function commit(){
        const idx = state.data.findIndex(t=>t.id==id);
        if (idx < 0) return;
        let val = input.value.trim();
        if (field !== "nome") val = Number(val)||0;
        state.data[idx][field] = val;
        render();
      }

      input.addEventListener("blur", commit);
      input.addEventListener("keydown", e=>{
        if(e.key==="Enter") input.blur();
        if(e.key==="Escape") render();
      });
    }

    const escapeHtml = (txt="") =>
      txt.replace(/[&<>"]/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[m]));

    // BOTÕES
    byId("addBtn").addEventListener("click", () => {
      const id = randomId();
      state.data.push({
        id, nome:`Time ${id}`,
        vitorias:0, empates:0, derrotas:0,
        golsM:0, golsS:0
      });
      render();
    });

    byId("delBtn").addEventListener("click", () => {
      if(!state.selectedId) return alert("Selecione uma linha.");
      if(!confirm("Excluir esta linha?")) return;
      state.data = state.data.filter(t=>t.id!=state.selectedId);
      state.selectedId = null;
      render();
    });

    // NOVO: RESETAR APENAS PONTOS/JOGOS
    byId("resetPointsBtn").addEventListener("click", () => {
      if (!confirm("Resetar pontos, jogos e gols de todos os times?")) return;

      state.data = state.data.map(t => ({
        ...t,
        vitorias:0,
        empates:0,
        derrotas:0,
        golsM:0,
        golsS:0
      }));

      render();
    });

    byId("clearBtn").addEventListener("click", () => {
      if(!confirm("Limpar tudo?")) return;
      state.data = [];
      state.selectedId = null;
      render();
    });

    // PDF EXPORT
    byId("exportPdfBtn").addEventListener("click", () => {
      state.data = computeAndSort(state.data);
      saveData(state.data);

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit:"pt", format:"a4" });

      doc.setFontSize(14);
      doc.text("Classificação", 40, 30);
      doc.setFontSize(10);

      const headers = ["Pos","Nome","Pts","Jog","Vit","Emp","Der","GM","GS","Saldo"];
      const colWidths = [30,200,40,36,40,40,40,40,40,36];
      let y = 50;

      doc.setFillColor(10,26,40);
      doc.rect(34,38, 520, 20, "F");
      doc.setTextColor(255,255,255);

      let x = 40;
      headers.forEach((h,i)=>{ doc.text(h, x+2, 52); x += colWidths[i]; });

      doc.setTextColor(0,0,0);
      y += 20;

      state.data.forEach((t, idx) => {
        let row = [
          idx+1, t.nome, t.pontos, t.jogos, t.vitorias,
          t.empates, t.derrotas, t.golsM, t.golsS, t.saldo
        ];
        x = 40;
        row.forEach((c,i)=>{ doc.text(String(c), x+2, y); x += colWidths[i]; });
        y += 16;

        if (y > 800) { doc.addPage(); y = 50; }
      });

      doc.save("classificacao.pdf");
    });

    render();
  </script>
</body>
</html>
